// Generated by CoffeeScript 1.6.3
var Bo, _ref,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Bo = (function(_super) {
  __extends(Bo, _super);

  function Bo() {
    this.click = __bind(this.click, this);
    this.register = __bind(this.register, this);
    _ref = Bo.__super__.constructor.apply(this, arguments);
    return _ref;
  }

  Bo.prototype.options = {
    animationDuration: 200,
    paneAttribute: 'bo-pane',
    paneTriggerAttribute: 'bo-trigger',
    change: function() {}
  };

  Bo.prototype.events = {
    'touchstart click': 'click'
  };

  Bo.prototype.panes = {};

  Bo.prototype.initialize = function(options) {
    var panes,
      _this = this;
    _.extend(this.options, options);
    this.model.on('set:active', function(key, pane) {
      if (pane) {
        return _this.options.change.call(_this, pane);
      }
    });
    this.model.set('active', null);
    panes = document.querySelectorAll("[" + this.options.paneAttribute + "]");
    _.each(panes, this.register);
    return (this.hideAll()).then(function() {
      var first;
      first = _.one(_this.panes);
      if (first) {
        return _this.show(first);
      }
    });
  };

  Bo.prototype.displayBlock = function() {
    return this.iterate(function(pane) {});
  };

  Bo.prototype.register = function(element) {
    var opts, pane;
    if (typeof element === 'String' || typeof element === 'Number') {
      opts = {
        id: element
      };
    } else {
      opts = {
        element: element
      };
    }
    opts = _.extend(opts, this.options);
    pane = new Pane(opts);
    return this.panes[pane.id] = pane;
  };

  Bo.prototype.iterate = function(fn) {
    return _.each(this.panes, fn);
  };

  Bo.prototype.hideAll = function() {
    var _this = this;
    return Promise.all(Object.keys(this.panes).map(function(_) {
      return _this.panes[_];
    }).map(function(_) {
      return _.right({
        instant: true
      });
    }));
  };

  Bo.prototype.show = function(id) {
    var index, newPane, oldPane;
    newPane = this.panes[id];
    oldPane = this.model.get('active');
    if (!newPane) {
      throw new ReferenceError('Pane with ID "' + id + '" does not exist in the DOM, or is not registered with Bo.');
    }
    if (oldPane) {
      index = newPane.index;
      if (index > oldPane.index) {
        newPane.right({
          instant: true
        }).then(function() {
          return Promise.all([oldPane.left(), newPane.show()]);
        });
      } else {
        newPane.left({
          instant: true
        }).then(function() {
          return Promise.all([oldPane.right(), newPane.show()]);
        });
      }
    } else {
      newPane.show({
        instant: true
      });
    }
    return this.model.set('active', newPane);
  };

  Bo.prototype.click = function(event) {
    var id;
    id = event.target.getAttribute(this.options.paneTriggerAttribute);
    if (id) {
      event.preventDefault();
      return this.show(id);
    }
  };

  return Bo;

})(View);
